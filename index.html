<!DOCTYPE html>
<html lang="ru">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>МЕБЕЛЬДОМ | Один салон — несколько фабрик</title>
    
    <!-- Шрифты: Playfair Display (Премиум) и Manrope (Текст) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Скрипт иконок) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Настройка цветов (Дерево и Золото) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Manrope"', 'sans-serif'],
                    },
                    colors: {
                        wood: {
                            900: '#14110f', // Черное дерево
                            800: '#1a1614', // Темный орех
                            700: '#2c2420',
                        },
                        gold: {
                            400: '#d4af37', // Классическое золото
                            500: '#c5a028',
                            600: '#b08d1e',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Скроллбар в стиле сайта */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #14110f; }
        ::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 10px; }
        
        /* Золотой градиент для текста */
        .gold-text {
            background: linear-gradient(135deg, #f3e5ab 0%, #d4af37 50%, #b08d1e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Затемнение для главного экрана */
        .hero-gradient {
            background: linear-gradient(to top, #14110f 10%, rgba(20, 17, 15, 0.5) 60%, rgba(0,0,0,0.3) 100%);
        }

        /* Цвета кнопок мессенджеров */
        .btn-tg { background-color: #2AABEE; }
        .btn-vk { background-color: #0077ff; }
        .btn-wa { background-color: #25D366; }

        /* Анимация пульсации для главной кнопки */
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }
        .animate-gold { animation: pulse-gold 2s infinite; }
    </style>
</head>
<body class="bg-wood-900 text-stone-200 font-sans antialiased">

    <!-- Плавающая кнопка (Telegram - Основная) -->
    <div class="fixed bottom-6 right-6 z-[100] group">
        <a href="https://t.me/+79638237733" target="_blank" class="w-14 h-14 btn-tg rounded-full flex items-center justify-center text-white shadow-2xl hover:scale-110 transition-transform animate-gold relative z-10">
            <i data-lucide="send" class="w-7 h-7"></i>
        </a>
        <!-- Всплывающая подсказка -->
        <div class="absolute right-16 top-3 bg-white text-wood-900 px-3 py-1 rounded text-xs font-bold whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            Напишите нам
        </div>
    </div>

    <!-- Шапка сайта (Header) -->
    <header class="fixed w-full z-50 bg-wood-900/95 backdrop-blur-md border-b border-gold-400/10 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            
            <!-- Логотип (Кресло) -->
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 border border-gold-400 flex items-center justify-center relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gold-400/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                    <!-- Иконка кресла (SVG hardcoded для надежности) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#d4af37" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3"/>
                        <path d="M3 16a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H7v-2a2 2 0 0 0-4 0Z"/>
                        <path d="M5 18v2"/>
                        <path d="M19 18v2"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-serif font-bold tracking-tighter text-white leading-none">МЕБЕЛЬ<span class="gold-text uppercase">дом</span></h1>
                    <p class="text-[8px] uppercase tracking-[0.3em] text-gold-400 font-bold mt-1">Комсомольск-на-Амуре</p>
                </div>
            </div>

            <!-- Меню (Навигация) -->
            <nav class="hidden lg:flex gap-8 text-[10px] uppercase tracking-widest font-extrabold text-stone-400">
                <a href="#catalog" class="hover:text-gold-400 transition-colors py-2">Каталог</a>
                <a href="#about" class="hover:text-gold-400 transition-colors py-2">Фабрика</a>
                <a href="#calc" class="hover:text-gold-400 transition-colors py-2">Расчет</a>
                <a href="#contacts" class="hover:text-gold-400 transition-colors py-2">Контакты</a>
            </nav>

            <!-- Контакты в шапке -->
            <div class="hidden md:flex items-center gap-6">
                <div class="text-right">
                    <a href="tel:+79638237733" class="text-white font-serif text-lg hover:text-gold-400 transition-colors tracking-tight block">+7 (963) 823-77-33</a>
                    <div class="text-[9px] text-stone-500 uppercase font-bold tracking-wider">Пр. Первостроителей 21</div>
                </div>
                <!-- Кнопки мессенджеров -->
                <div class="flex gap-2">
                    <a href="https://t.me/+79638237733" class="w-9 h-9 rounded-full bg-[#2AABEE] flex items-center justify-center text-white hover:scale-110 transition-transform shadow-lg" title="Telegram">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </a>
                    <a href="https://vk.com/mebeldom" class="w-9 h-9 rounded-full bg-[#0077ff] flex items-center justify-center text-white hover:scale-110 transition-transform shadow-lg opacity-80 hover:opacity-100" title="VK">
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                    </a>
                </div>
            </div>

            <!-- Мобильное меню (Гамбургер) -->
            <button class="lg:hidden text-white p-2" onclick="document.getElementById('mobile-nav').classList.toggle('hidden')">
                <i data-lucide="menu" class="w-8 h-8"></i>
            </button>
        </div>
        
        <!-- Выпадающее мобильное меню -->
        <div id="mobile-nav" class="hidden absolute top-full left-0 w-full bg-wood-900 border-b border-white/10 p-6 flex flex-col gap-4 text-center shadow-2xl">
            <a href="#catalog" class="text-white text-sm uppercase tracking-widest">Каталог</a>
            <a href="#about" class="text-white text-sm uppercase tracking-widest">О нас</a>
            <a href="https://t.me/+79638237733" class="btn-tg text-white py-3 rounded font-bold uppercase text-xs">Написать в Telegram</a>
        </div>
    </header>

    <!-- Главный экран (Hero Section) -->
    <section class="relative h-screen min-h-[600px] flex items-center justify-center overflow-hidden">
        <!-- Фон (Картинка) -->
        <div class="absolute inset-0 z-0">
            <!-- Прямая ссылка на надежное изображение -->
            <img src="https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?ixlib=rb-4.0.3&auto=format&fit=crop&q=85&w=2000" 
                 class="w-full h-full object-cover opacity-60 scale-105 animate-pulse-slow" 
                 alt="Luxury Interior Background">
            <div class="absolute inset-0 hero-gradient"></div>
        </div>

        <div class="relative z-10 container mx-auto px-4 text-center mt-12">
            <div class="inline-block mb-6">
                <span class="text-gold-400 uppercase tracking-[0.4em] text-[10px] font-black border border-gold-400/30 px-4 py-2 bg-black/20 backdrop-blur-sm rounded-sm">
                    Комсомольск-на-Амуре
                </span>
            </div>
            
            <h1 class="text-3xl md:text-5xl lg:text-6xl font-serif text-white mb-8 leading-tight max-w-5xl mx-auto">
                Один салон — несколько фабрик: <br> 
                <span class="italic text-gold-400 text-xl md:text-3xl lg:text-4xl block mt-4 font-light opacity-90">
                    от простой тумбочки до сложной кухни в элитном стиле
                </span>
            </h1>

            <div class="flex flex-col sm:flex-row gap-5 justify-center items-center mt-10">
                <a href="https://t.me/+79638237733" class="btn-tg text-white px-10 py-4 font-bold uppercase tracking-widest text-xs hover:bg-[#2595cf] transition-all flex items-center gap-3 shadow-[0_0_30px_rgba(42,171,238,0.3)] rounded-sm group">
                    <i data-lucide="send" class="w-4 h-4 group-hover:-translate-y-1 group-hover:translate-x-1 transition-transform"></i> 
                    Написать в Telegram
                </a>
                <a href="#calc" class="group bg-transparent border border-white/20 text-white px-10 py-4 font-bold uppercase tracking-widest text-xs hover:bg-white hover:text-wood-900 transition-all rounded-sm backdrop-blur-sm">
                    Рассчитать стоимость
                </a>
            </div>
        </div>
    </section>

    <!-- Блок 2: Новинки (Каталог) -->
    <section id="catalog" class="py-20 bg-wood-900">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
                <div>
                    <h2 class="text-gold-400 uppercase tracking-widest text-[10px] font-black mb-2">Portfolio</h2>
                    <h3 class="text-3xl md:text-4xl font-serif text-white italic">Избранные новинки</h3>
                </div>
                <div class="w-full md:w-auto h-px bg-white/10 flex-grow ml-8 mb-4 hidden md:block"></div>
            </div>

            <div id="products-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Карточки будут загружены через JS -->
                <div class="animate-pulse bg-wood-800 h-80 rounded-sm"></div>
                <div class="animate-pulse bg-wood-800 h-80 rounded-sm"></div>
                <div class="animate-pulse bg-wood-800 h-80 rounded-sm"></div>
            </div>
        </div>
    </section>

    <!-- Блок 3: Преимущества (Дерево и Металл) -->
    <section id="about" class="py-24 bg-wood-800 relative border-y border-white/5">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="grid grid-cols-2 gap-4 relative">
                    <!-- Декор элемент -->
                    <div class="absolute -top-4 -left-4 w-20 h-20 border-t-2 border-l-2 border-gold-400 opacity-50"></div>
                    
                    <img src="https://images.unsplash.com/photo-1604709177225-055f99402ea3?auto=format&fit=crop&q=80&w=800" 
                         class="w-full h-64 object-cover grayscale hover:grayscale-0 transition-all duration-700 rounded-sm shadow-xl" 
                         alt="Wood Texture">
                    <img src="https://images.unsplash.com/photo-1556911220-e15b29be8c8f?auto=format&fit=crop&q=80&w=800" 
                         class="w-full h-64 object-cover mt-8 grayscale hover:grayscale-0 transition-all duration-700 rounded-sm shadow-xl" 
                         alt="Kitchen Interior">
                </div>
                <div>
                    <h2 class="text-3xl font-serif text-white mb-6">
                        <span class="text-gold-400 italic">Собственное производство</span> <br> и мировые бренды
                    </h2>
                    <p class="text-stone-400 mb-8 leading-relaxed font-light text-sm">
                        Мы официально представляем интересы <strong class="text-white">двух крупнейших мебельных холдингов</strong> и являемся партнерами инновационного производства фурнитуры. Плюс — собственная столярная фабрика в Комсомольске для реализации ваших самых смелых идей.
                    </p>
                    <ul class="space-y-6">
                        <li class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-wood-900 border border-gold-400 flex items-center justify-center shrink-0 text-gold-400">
                                <i data-lucide="hammer" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-1">Свой цех в городе</h4>
                                <p class="text-stone-500 text-xs">Любые нестандартные размеры без переплат.</p>
                            </div>
                        </li>
                        <li class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-wood-900 border border-gold-400 flex items-center justify-center shrink-0 text-gold-400">
                                <i data-lucide="gem" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold text-sm uppercase tracking-wider mb-1">От Эконом до Люкс</h4>
                                <p class="text-stone-500 text-xs">Подберем материалы под ваш бюджет.</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Блок 4: Квиз (Расчет стоимости) -->
    <section id="calc" class="py-24 bg-wood-900">
        <div class="container mx-auto px-4 max-w-5xl">
            <div class="bg-wood-800 border border-gold-400/20 shadow-2xl flex flex-col md:flex-row rounded-sm overflow-hidden">
                <!-- Левая часть квиза -->
                <div class="w-full md:w-5/12 p-10 bg-stone-100 text-wood-900 flex flex-col justify-center relative">
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-gold-400 to-gold-600"></div>
                    <h3 class="text-2xl md:text-3xl font-serif font-bold mb-4">Узнайте стоимость вашего проекта</h3>
                    <p class="text-sm opacity-70 mb-8 leading-relaxed">Пройдите короткий тест и получите расчет цены в 3-х вариантах исполнения.</p>
                    
                    <div class="mt-auto">
                        <div class="flex items-center gap-3 text-gold-600 font-black text-xs uppercase tracking-widest mb-2">
                            <i data-lucide="gift" class="w-5 h-5"></i>
                            <span>Бонус</span>
                        </div>
                        <p class="text-xs font-bold">3D-проект кухни в подарок при расчете сегодня.</p>
                    </div>
                </div>
                
                <!-- Правая часть (Интерактив) -->
                <div class="w-full md:w-7/12 p-8 md:p-12 flex flex-col justify-center bg-wood-800 relative" id="quiz-container">
                    <!-- Сюда JS загрузит вопросы -->
                </div>
            </div>
        </div>
    </section>

    <!-- Футер -->
    <footer id="contacts" class="bg-black text-stone-500 pt-20 pb-8 border-t border-white/10">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
            <div class="col-span-1 md:col-span-1">
                <h2 class="text-xl font-serif text-white mb-6 uppercase tracking-tighter">МЕБЕЛЬ<span class="gold-text">дом</span></h2>
                <p class="text-xs leading-relaxed mb-6">Создаем пространства, которые вдохновляют. Официальный партнер федеральных фабрик.</p>
                <!-- Соцсети -->
                <div class="flex gap-3">
                    <a href="https://t.me/+79638237733" class="w-10 h-10 border border-white/10 flex items-center justify-center text-white hover:bg-[#2AABEE] hover:border-[#2AABEE] transition-all rounded-sm"><i data-lucide="send" class="w-4 h-4"></i></a>
                    <a href="https://vk.com/mebeldom" class="w-10 h-10 border border-white/10 flex items-center justify-center text-white hover:bg-[#0077ff] hover:border-[#0077ff] transition-all rounded-sm"><i data-lucide="share-2" class="w-4 h-4"></i></a>
                    <a href="https://wa.me/79638237733" class="w-10 h-10 border border-white/10 flex items-center justify-center text-white hover:bg-[#25D366] hover:border-[#25D366] transition-all rounded-sm"><i data-lucide="message-circle" class="w-4 h-4"></i></a>
                </div>
            </div>
            
            <div>
                <h3 class="text-white font-serif text-sm mb-6 uppercase tracking-widest text-gold-400">Адрес</h3>
                <p class="text-xs leading-loose">
                    Комсомольск-на-Амуре<br>
                    Проспект Первостроителей 21<br>
                    <span class="text-stone-300">Ежедневно: 10:00 — 19:00</span>
                </p>
            </div>

            <div>
                <h3 class="text-white font-serif text-sm mb-6 uppercase tracking-widest text-gold-400">Связь</h3>
                <a href="tel:+79638237733" class="text-lg text-white font-serif block mb-2 hover:text-gold-400 transition-colors">+7 (963) 823-77-33</a>
                <a href="https://t.me/+79638237733" class="text-xs hover:text-[#2AABEE] transition-colors flex items-center gap-1"><i data-lucide="send" class="w-3 h-3"></i> Telegram</a>
            </div>

            <div>
                <h3 class="text-white font-serif text-sm mb-6 uppercase tracking-widest text-gold-400">Консультация</h3>
                <form class="space-y-3" onsubmit="alert('Спасибо! Мы перезвоним.'); return false;">
                    <input type="tel" placeholder="Номер телефона" class="w-full bg-white/5 border border-white/10 p-3 text-xs text-white outline-none focus:border-gold-400 transition-colors">
                    <button class="w-full bg-white text-wood-900 py-3 font-black uppercase text-[10px] tracking-widest hover:bg-gold-400 transition-all">Заказать звонок</button>
                </form>
            </div>
        </div>
        <div class="text-center text-[9px] uppercase tracking-[0.3em] opacity-30 pt-8 border-t border-white/5">
            &copy; 2024 МЕБЕЛЬДОМ. Все права защищены.
        </div>
    </footer>

    <!-- Firebase & Logic (ОБНОВЛЕНО ДЛЯ РАБОТЫ БЕЗ СЕРВЕРА) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // --- ВАЖНОЕ ИСПРАВЛЕНИЕ ДЛЯ ХОСТИНГА ---
        // Проверяем, есть ли конфиг Firebase (в Immersive он есть, на хостинге - нет)
        const isDemoMode = typeof __firebase_config === 'undefined';
        
        let db = null;
        let auth = null;
        let user = null;
        let appId = 'demo-app';

        async function initApp() {
            if (!isDemoMode) {
                // Если мы в Immersive - грузим реальный Firebase
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (u) => {
                    user = u;
                    if(u) { 
                        loadProducts(); 
                        initQuiz(); 
                    }
                });
            } else {
                // ДЕМО РЕЖИМ (Работает везде)
                console.log("Запущен демо-режим (без бэкенда)");
                user = { uid: 'demo-user', isAnonymous: true };
                // Имитируем задержку сети для реалистичности
                setTimeout(() => {
                    loadProducts();
                    initQuiz();
                }, 500);
            }
        }
        
        initApp();

        // Загрузка товаров (С поддержкой Демо)
        function loadProducts() {
            const productsGrid = document.getElementById('products-grid');
            const defaultItems = [
                {title: 'Кухня "Onyx Premium"', price: 'от 220 000 ₽', image: 'https://images.unsplash.com/photo-1556911220-e15b29be8c8f?auto=format&fit=crop&q=80&w=800'},
                {title: 'Шкаф "Loft Wood"', price: 'от 65 000 ₽', image: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?auto=format&fit=crop&q=80&w=800'},
                {title: 'Гардеробная "Gold Line"', price: 'от 140 000 ₽', image: 'https://images.unsplash.com/photo-1558603668-6570496b66f8?auto=format&fit=crop&q=80&w=800'}
            ];

            if (!isDemoMode && db) {
                // Реальная загрузка
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'products_v4'), orderBy('createdAt', 'desc'));
                onSnapshot(q, (snapshot) => {
                    renderItems(snapshot.empty ? defaultItems : snapshot.docs.map(d => d.data()));
                });
            } else {
                // Демо загрузка
                renderItems(defaultItems);
            }
            
            function renderItems(items) {
                productsGrid.innerHTML = '';
                items.forEach(data => {
                    const div = document.createElement('div');
                    div.className = 'group bg-wood-800 border border-white/5 hover:border-gold-400/30 transition-all duration-500 rounded-sm overflow-hidden';
                    div.innerHTML = `
                        <div class="h-72 overflow-hidden relative">
                            <img src="${data.image}" alt="${data.title}" loading="lazy" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-1000 group-hover:scale-110">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                        </div>
                        <div class="p-6">
                            <h4 class="text-white font-serif text-lg mb-4 italic leading-tight">${data.title}</h4>
                            <div class="flex justify-between items-center border-t border-white/5 pt-4">
                                <span class="text-gold-400 font-bold tracking-wide">${data.price}</span>
                                <a href="https://t.me/+79638237733" class="text-[10px] uppercase font-black tracking-widest text-stone-500 hover:text-white transition-colors flex items-center gap-1">
                                    Заказать <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                </a>
                            </div>
                        </div>
                    `;
                    productsGrid.appendChild(div);
                });
                setTimeout(() => lucide.createIcons(), 200);
            }
        }

        // Логика Квиза
        let currentStep = 0;
        let answers = { category: '', budget: '', phone: '' };
        const quizContainer = document.getElementById('quiz-container');

        const quizSteps = [
            {
                title: "Что будем изготавливать?",
                options: ["Кухня под заказ", "Шкаф-купе / Гардеробная", "Мебель в ванную / Прихожая", "Комплексная меблировка"],
                key: 'category'
            },
            {
                title: "Комфортный бюджет?",
                options: ["Эконом (ЛДСП)", "Стандарт (МДФ / Пленка)", "Премиум (Эмаль / Шпон / Массив)"],
                key: 'budget'
            }
        ];

        window.initQuiz = () => renderStep();

        function renderStep() {
            if (currentStep < quizSteps.length) {
                const s = quizSteps[currentStep];
                quizContainer.innerHTML = `
                    <div class="animate-fade-in-up">
                        <div class="flex justify-between items-center mb-6">
                            <div class="text-[10px] text-gold-400 font-black uppercase tracking-[0.3em]">Шаг ${currentStep + 1} / 3</div>
                        </div>
                        <h4 class="text-2xl font-serif text-white mb-8 leading-tight">${s.title}</h4>
                        <div class="grid grid-cols-1 gap-3">
                            ${s.options.map(opt => `
                                <button onclick="handleSelect('${s.key}', '${opt}')" class="text-left p-5 border border-white/10 text-stone-400 hover:border-gold-400 hover:text-gold-400 hover:bg-gold-400/5 transition-all text-sm font-bold uppercase tracking-widest flex justify-between group">
                                    ${opt}
                                    <i data-lucide="chevron-right" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                quizContainer.innerHTML = `
                    <div class="text-center animate-fade-in-up">
                        <div class="w-16 h-16 bg-gold-400/10 border border-gold-400/50 rounded-full flex items-center justify-center mx-auto mb-6 text-gold-400 animate-pulse">
                            <i data-lucide="check" class="w-8 h-8"></i>
                        </div>
                        <h4 class="text-2xl font-serif text-white mb-4">Расчет готов!</h4>
                        <p class="text-stone-500 text-xs mb-8 uppercase tracking-widest">Оставьте телефон (желательно с Telegram), мы пришлем смету туда.</p>
                        <form onsubmit="handleFinish(event)" class="max-w-xs mx-auto space-y-4">
                            <input type="tel" id="q-phone" placeholder="+7 (___) ___-__-__" class="w-full bg-wood-900 border border-white/20 p-4 text-white text-center font-bold text-lg outline-none focus:border-gold-400 rounded-sm" required>
                            <button type="submit" class="w-full bg-gold-400 text-wood-900 py-4 font-black uppercase text-xs tracking-[0.2em] hover:bg-white transition-all rounded-sm shadow-lg">Получить расчет</button>
                        </form>
                    </div>
                `;
            }
            setTimeout(() => lucide.createIcons(), 100);
        }

        window.handleSelect = (key, val) => {
            answers[key] = val;
            currentStep++;
            renderStep();
        };

        window.handleFinish = async (e) => {
            e.preventDefault();
            answers.phone = document.getElementById('q-phone').value;
            try {
                if(!isDemoMode && user) {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'leads_v4'), {
                        ...answers, createdAt: serverTimestamp()
                    });
                } else {
                    // Демо отправка
                    console.log("Заявка (Демо):", answers);
                }
                
                quizContainer.innerHTML = `
                    <div class="text-center py-10">
                        <h4 class="text-3xl font-serif text-gold-400 mb-4 italic">Спасибо!</h4>
                        <p class="text-white text-sm uppercase tracking-widest mb-6">Ваша заявка №${Math.floor(Math.random() * 1000)} принята.</p>
                        <a href="https://t.me/+79638237733" class="text-stone-400 hover:text-white underline text-xs uppercase tracking-widest">Написать менеджеру</a>
                    </div>
                `;
            } catch(err) { console.error(err); }
        };

        window.lucide = lucide; 
        if (document.readyState === 'loading') {  
            document.addEventListener('DOMContentLoaded', () => lucide.createIcons());
        } else {  
            lucide.createIcons();
        }
    </script>
</body>

</html>
